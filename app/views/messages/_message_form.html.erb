<%= form_for message, remote: true, authenticity_token: true do |f| %>
  <%= f.label :your_message %>:
  <%= f.text_area :content, class: "form-control", data: {textarea: "message"} %>

  <%= f.hidden_field :groupchat_id, value: @groupchat.id %>
  <%= f.submit "send", class: "btn btn-primary", style: "display: none;", data: {send: "message"} %>
  <button type="button" onclick="getLocation()" alignment="right">Send My Location</button>
<% end %>

<script>
var options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0
};

function getLocation() {
  if (navigator.geolocation) {
	  navigator.geolocation.getCurrentPosition(showPosition, error, options);
	} else {
    document.getElementById("message_content").value = "Geolocation is not supported by this browser.";
  }
}

function error(err) {
  console.warn(`ERROR(${err.code}): ${err.message}`);
};

function showPosition(position) {
  document.getElementById("message_content").value = "LatitudeLongitude;" + position.coords.latitude + 
    ";" + position.coords.longitude; 
  $('[data-send="message"]').click();
  $('[data-textarea="message"]').val("")
  return false;
}

</script>
